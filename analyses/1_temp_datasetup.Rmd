---
title: "temp - data setup"
author: "Nathan Brouwer"
date: "January 30, 2018"
output: html_document
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```




## Libraries
```{r}
## modeling
library(lme4)
library(blme)

## predictions
library(merTools)# has predictInterval()
library(foreach)

## AIC tables
library(bbmle)

## Plotting
library(sjPlot)

library(ggplot2)
library(cowplot)

```



## Load cleaned and scrubbed data

```{r}
load("./data/annual_captures.RData")
```


## Set up factors for easy interp with summary

```{r}

ann_caps$site <- factor(ann_caps$site,
                        levels = c("La Cueva","La Caoba",
                                  "Morelia","El Corral", "Aceitillar"))
ann_caps$spp.code <- factor(ann_caps$spp.code)
ann_caps$sex.M <- factor(ann_caps$sex.M,
                            levels = c("other","M"))
ann_caps$status.focals <- factor(ann_caps$status.focals)
summary(ann_caps[, c("spp.code","site",
                     "sex.M","age.AHY.01",
                     "site.age","site.age.init",
                     "status.focals")])


with(ann_caps, table(site,site.age,useNA = "always"))

with(ann_caps, table(age,age.AHY.01,useNA = "always"))
```

## Subset by focal species

### Focal spp
```{r}
focal.mig <- c("OVEN","BAWW","COYE","AMRE","CMWA",
               "BTBW","PAWA","PRAW")

focal.res <- c("HLCU","HILC",         #fix - which name to use?
               "STOF",
               "RLTH","NOMO",
               "GRWA",       "GTGT",   #fix - which name to use?
               "BANA","BCPT",
               "YFGR","BFGR",
               "GABU",
               "BWVI", #32; Aceitillar / Cueva +misc
               "GREP") #18 just Aceitillar - ever yr

focals <- c(focal.mig,focal.res)
```



Update "status focals" column
```{r}
i.res <- which(ann_caps$spp.code %in% focal.res)

ann_caps$status.focals[i.res] <- "res"
```




### Subset by focal spp
```{r}
i.focals <- which(ann_caps$spp.code %in% focals)
 
ann_caps2 <- ann_caps[i.focals,]
```

```{r}
summary(ann_caps2$spp.code)
```



### Which spp are not "focal"


```{r}
summary(factor(as.character(ann_caps2[-i.focals,"spp.code"])))
```


```{r}
summary(factor(as.character(ann_caps2[i.focals,"spp.code"])))
```


```{r}
i.BWVI <- which(ann_caps2$spp.code == "BWVI") # 32; Aceitillar / Cueva +misc
i.GREP <- which(ann_caps2$spp.code == "GREP") # 18 just Aceitillar - ever yr

i.HISP <- which(ann_caps2$spp.code == "HISP") # 16 misc
i.KWQD <- which(ann_caps2$spp.code == "KWQD") # 19 Corral most years + misc
i.MACU <- which(ann_caps2$spp.code == "MACU") # 14 Corral most years + misc
i.MAWA <- which(ann_caps2$spp.code == "MAWA") # 13 misc
with(ann_caps2[i.KWQD,],table(site,year))
```


## Isolate unique individuals

To remove repeated measures; this simplifies the models but tosses out data

```{r}
i.unique <- match(unique(ann_caps2$band),
                  ann_caps2$band)
```







## Isolate unique individuals

To remove repeated measures; this simplifies the models but tosses out data

```{r}

i.unique <- match(unique(ann_caps2$band),
                  ann_caps2$band)

dim(ann_caps2)
length(unique(ann_caps2$band))
length(i.unique)


ann_caps3 <- ann_caps2[i.unique,]
```


### Remove aceitillar
```{r}

ann_caps2[which(ann_caps2$site == "Aceitillar" & ann_caps2$year == "2002-2003"),]

#ann_caps2
i.ann_caps2_aceit <- which(ann_caps2$site == "Aceitillar")

#ann_caps3
i.ann_caps3_aceit <- which(ann_caps3$site == "Aceitillar")

ann_caps2$band[i.ann_caps2_aceit]

```

### final prep

#### ann_caps2
```{r}
#create unique spp-site combo
ann_caps2$spp_site <- with(ann_caps2,paste(spp.code, site))

#center site age variable
ann_caps2$site.age.cent <- scale(ann_caps2$site.age,scale = F)

```

#### ann_caps3
```{r}
#create unique spp-site combo
ann_caps3$spp_site <- with(ann_caps3,paste(spp.code, site))

#center site age variable
ann_caps3$site.age.cent <- scale(ann_caps3$site.age,scale = F)

```

## Dataframes

ann_caps  = all data
ann_caps2 = just focal spp
ann_caps3 = just 1st captures of each individual

i.ann_caps2_aceit = index of Aceitillar w/in ann_caps2
i.ann_caps3_aceit = index of Aceitillar w/in ann_caps3

```{r}

```

